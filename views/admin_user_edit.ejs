<% 
  // Set page-specific variables for the layout
  const pageTitle = 'Edit User';
  const currentPage = 'users';
  
  // Main content for this page
  const body = `
    <header style="margin-bottom: var(--md-spacing-xl);">
      <h2 class="md-headline-3" style="color: var(--md-primary); margin: 0;">Edit User</h2>
      <p style="color: var(--md-on-surface-variant); margin-top: var(--md-spacing-sm);">
        Update user account information and permissions
      </p>
    </header>

    ${error ? `
      <div class="error-message">
        <strong>Error:</strong> ${error}
      </div>
    ` : ''}

    <div class="md-card md-elevation-1" style="padding: var(--md-spacing-xl);">
      <h3 class="section-title">Edit User Information</h3>
      <form method="POST" action="/admin/users/${user.id}/update" class="edit-form">
        <div class="form-row">
          <div class="form-field">
            <label class="md-input-label" for="username">Username *</label>
            <input 
              id="username"
              name="username" 
              class="md-input" 
              value="${user.username || ''}"
              placeholder="Enter username" 
              required 
            />
          </div>
          
          <div class="form-field">
            <label class="md-input-label" for="role">Role *</label>
            <select id="role" name="role" class="form-select" required>
              <option value="client" ${user.role === 'client' ? 'selected' : ''}>Client</option>
              <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <label class="md-input-label" for="first_name">First Name</label>
            <input 
              id="first_name"
              name="first_name" 
              class="md-input" 
              value="${user.first_name || ''}"
              placeholder="Enter first name"
            />
          </div>
          
          <div class="form-field">
            <label class="md-input-label" for="last_name">Last Name</label>
            <input 
              id="last_name"
              name="last_name" 
              class="md-input" 
              value="${user.last_name || ''}"
              placeholder="Enter last name"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <label class="md-input-label" for="email">Email</label>
            <input 
              id="email"
              name="email" 
              type="email"
              class="md-input" 
              value="${user.email || ''}"
              placeholder="Enter email address"
            />
          </div>
          
          <div class="form-field">
            <label class="md-input-label" for="phone">Phone</label>
            <input 
              id="phone"
              name="phone" 
              type="tel"
              class="md-input" 
              value="${user.phone || ''}"
              placeholder="Enter phone number"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <label class="md-input-label" for="job_title">Job Title</label>
            <input 
              id="job_title"
              name="job_title" 
              class="md-input" 
              value="${user.job_title || ''}"
              placeholder="Enter job title"
            />
          </div>
          
          <div class="form-field">
            <label class="md-input-label" for="organization_id">Organization *</label>
            <select id="organization_id" name="organization_id" class="form-select" required>
              ${organizations.map(org => `
                <option value="${org.id}" ${user.organization_id === org.id ? 'selected' : ''}>${org.name}</option>
              `).join('')}
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <label class="md-input-label" for="status">Status *</label>
            <select id="status" name="status" class="form-select" required>
              <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
              <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Inactive</option>
              <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
            </select>
          </div>
          
          <div class="form-field">
            <label class="md-input-label" for="password">New Password</label>
            <input 
              id="password"
              name="password" 
              type="password" 
              class="md-input"
              placeholder="Leave blank to keep current password" 
            />
            <small style="color: var(--md-on-surface-variant); font-size: var(--md-font-size-caption);">
              Only enter a password if you want to change it
            </small>
          </div>
        </div>
        
        <div class="form-actions">
          <a href="/admin/users" class="md-button md-button-text">
            <span class="md-icon md-icon-sm">‚Üê</span>
            Cancel
          </a>
          <button type="submit" class="md-button md-button-filled">
            <span class="md-icon md-icon-sm">üíæ</span>
            Update User
          </button>
        </div>
      </form>
    </div>

    <style>
      .edit-form {
        max-width: 800px;
      }
      
      .form-row {
        display: flex;
        gap: var(--md-spacing-lg);
        margin-bottom: var(--md-spacing-lg);
      }
      
      .form-field {
        flex: 1;
        min-width: 0;
      }
      
      .form-actions {
        display: flex;
        gap: var(--md-spacing-md);
        justify-content: flex-end;
        margin-top: var(--md-spacing-xl);
        padding-top: var(--md-spacing-lg);
        border-top: 1px solid var(--md-outline-variant);
      }
      
      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
          gap: var(--md-spacing-md);
        }
        
        .form-actions {
          flex-direction: column-reverse;
        }
        
        .form-actions .md-button {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  `;
%>

<%- include('./partials/admin_layout', { pageTitle, currentPage, body }) %>